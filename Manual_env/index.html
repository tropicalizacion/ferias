
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/logos/logo_rojo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.17">
    
    
      
        <title>Configuraci칩n del sitio - Proyecto deferia.cr</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Nunito Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="feria" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#configuracion-del-sitio" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href=".." title="Proyecto deferia.cr" class="md-header__button md-logo" aria-label="Proyecto deferia.cr" data-md-component="logo">
      
  <img src="../assets/logos/logo_blanco.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Proyecto deferia.cr
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Configuraci칩n del sitio
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="B칰squeda" placeholder="B칰squeda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando b칰squeda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/fabianabarca/ferias" title="Ir al repositorio" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    fabianabarca/ferias
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Pesta침as" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Inicio

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../identidad/" class="md-tabs__link">
        
  
  
    
  
  Identidad visual

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../sobre/" class="md-tabs__link">
        
  
  
    
  
  Sobre el proyecto

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../howto.md" class="md-tabs__link">
        
  
  
    
  
  Desarrollo

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../models.md" class="md-tabs__link">
        
  
  
    
  
  Modelos

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../sitemap.md" class="md-tabs__link">
        
  
  
    
  
  Mapa del sitio

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navegaci칩n" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Proyecto deferia.cr" class="md-nav__button md-logo" aria-label="Proyecto deferia.cr" data-md-component="logo">
      
  <img src="../assets/logos/logo_blanco.svg" alt="logo">

    </a>
    Proyecto deferia.cr
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/fabianabarca/ferias" title="Ir al repositorio" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    fabianabarca/ferias
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inicio
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../identidad/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Identidad visual
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sobre/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sobre el proyecto
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../howto.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Desarrollo
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../models.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modelos
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sitemap.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mapa del sitio
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="configuracion-del-sitio">Configuraci칩n del sitio</h1>
<p>Estos son algunos consejos e instrucciones para usar el proyecto localmente o en el servidor.</p>
<blockquote>
<p>[!TIP]
Se recomienda hacer uso del contenedor de Docker para el desarrollo de la aplicaci칩n, ya que este manual podr칤a no ser tan detallado o no estar actualizado.</p>
<p>[!WARNING]
Es ideal no saltarse pasos de esta gu칤a, y de ser necesario, solicitar ayuda.</p>
</blockquote>
<h2 id="clave-secreta-de-django">Clave secreta de Django</h2>
<p>La clave secreta de Django y otras configuraciones est치n en un archivo <code>.env</code> y es manipulado por el paquete <code>python-decouple</code> (<a href="https://pypi.org/project/python-decouple/">documentaci칩n</a>).</p>
<h2 id="ambiente-virtual">Ambiente virtual</h2>
<p>Para desarrollar el proyecto de forma local se recomienda crear un ambiente virtual de python. Esto se puede realizar con los siguientes comandos:</p>
<div class="highlight"><pre><span></span><code>ferias:<span class="w"> </span>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>feriasenv
</code></pre></div>
<p>Activarlo con:</p>
<div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>feriasenv/bin/activate
</code></pre></div>
<p>y desactivarlo con:</p>
<div class="highlight"><pre><span></span><code>deactivate
</code></pre></div>
<p>Para iniciar, instalar todos los paquetes especificados en el archivo <code>requirements.txt</code>, con:</p>
<div class="highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</code></pre></div>
<p>Se agrega el archivo <code>.env</code> al directorio ra칤z. Nota: (en caso de ser necesario) al descargar el archivo <code>.env</code> y pasarlo al directorio ra칤z puede salir como <code>.env.env</code> se debe cambiar esto a solo <code>.env</code>.</p>
<p>(Seguir instrucciones de la documentaci칩n).</p>
<blockquote>
<p>El equipo de desarrolladores compartir치 el documento <code>.env</code>.</p>
</blockquote>
<p>Luego, se deben instalar los paquetes necesarios para el proyecto. Para hacer esto, en una terminal desde la ra칤z del proyecto, ejecute el siguiente comando:</p>
<div class="highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</code></pre></div>
<h2 id="crear-base-de-datos-y-migrar-a-geodjango">Crear base de datos y migrar a GeoDjango</h2>
<p>El proyecto utiliza <a href="https://www.postgresql.org/">PostgreSQL</a>. Una vez instalado puede ser controlado en terminal con <code>psql</code>, por ejemplo: <code>psql ferias</code> para entrar al CLI de la base de datos y hacer <em>queries</em> o modificar las tablas directamente. Nota: mucho cuidado con esto porque puede interferir con las migraciones de Django y causar problemas. </p>
<p><a href="https://docs.djangoproject.com/en/4.2/ref/contrib/gis/">GeoDjango</a> es la extensi칩n de Django para trabajar con datos geoespaciales. Ser치 utilizado con PostgreSQL y PostGIS.</p>
<p>Los pasos de creaci칩n de la base de datos son:</p>
<ol>
<li>Instalar PostgreSQL en la m치quina seg칰n el OS.</li>
<li>Instalar PostGIS en la m치quina <a href="https://postgis.net/documentation/getting_started/#installing-postgis">seg칰n el OS</a>.</li>
<li>Crear base de datos <code>ferias</code> con <code>$ createdb ferias</code>.</li>
<li>Ingresar a la base de datos con <code>$ psql ferias</code>.</li>
<li><a href="https://docs.djangoproject.com/en/4.2/ref/contrib/gis/install/postgis/">Habilitar PostGIS</a> para la base de datos <code>ferias</code> en <code>psql</code> con <code># CREATE EXTENSION postgis;</code>.</li>
<li>Habilitar la b칰squeda por <a href="https://docs.djangoproject.com/en/4.2/ref/contrib/postgres/lookups/#trigram-similarity"><em>trigram similarity</em></a> en <code>psql ferias</code> con <code>CREATE EXTENSION IF NOT EXISTS pg_trgm;</code></li>
<li>Habilitar la b칰squeda <a href="https://www.postgresql.org/docs/current/unaccent.html"><em>sin acentos</em></a> en <code>psql ferias</code> con <code>CREATE EXTENSION IF NOT EXISTS unaccent;</code></li>
<li>En algunos sistemas operativos (Windows y macOS Apple Silicon s칤, Linux y macOS Intel no), es necesario adjuntar a <code>settings.py</code> las ubicaciones de GDAL y GEOS (esto se hace autom치ticamente), y tambi칠n en el archivo <code>.env</code> tal y como se puede apreciar en el <a href="../.env.example">archivo de ejemplo</a>.</li>
</ol>
<p>En <code>settings.py</code> se encuentra configurado lo necesario para la base de datos, no es necesario modificarlo ya que toma los valores del archivo <code>.env</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;ENGINE&quot;</span><span class="p">:</span> <span class="s2">&quot;django.contrib.gis.db.backends.postgis&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NAME&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">(</span><span class="s1">&#39;DB_NAME&#39;</span><span class="p">),</span>
        <span class="s2">&quot;USER&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">(</span><span class="s1">&#39;DB_USER&#39;</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="s2">&quot;django.contrib.postgres&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.gis&quot;</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div>
<h3 id="migraciones">Migraciones</h3>
<ul>
<li>Hacer todas las migraciones con <code>$ python manage.py makemigrations marketplaces</code> y as칤 para cada app (products, crowdsourcing, website, etc.)</li>
<li>Migrar con <code>$ python manage.py migrate</code> para crear las tablas.</li>
<li>Hacer <code>$ python manage.py loaddata auth</code> para cargar los datos de usuarios de prueba del fixture (peligroso).</li>
<li>Hacer <code>$ python manage.py loaddata marketplaces</code> para cargar los datos de las ferias del fixture (peligroso).</li>
<li>Hacer <code>$ python manage.py loaddata products</code> para cargar los datos de los productos del fixture (peligroso).</li>
<li>(etc.)</li>
</ul>
<p>Con esto deber칤a funcionar la aplicaci칩n con PostgreSQL y PostGIS activado para usar GeoDjango, que permite guardar ubicaciones y regiones en el mapa y hacer b칰squedas geoespaciales.</p>
<blockquote>
<p>[!NOTE]
Dentro de la carpeta <em>scripts</em> hay archivos que permiten automatizar las migraciones previamente mencionadas.</p>
</blockquote>
<h3 id="destruir-la-base-de-datos">Destruir la base de datos</h3>
<p>En caso de pruebas y de ser necesario:</p>
<ul>
<li><code>$ psql postgres</code></li>
<li><code># DROP DATABASE ferias;</code></li>
<li><img alt="游땳" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f62c.svg" title=":grimacing:" /></li>
<li>Borrar todos los archivos de migraciones de todas las apps antes de intentar hacer las migraciones de nuevo</li>
</ul>
<h2 id="ejecutar-el-proyecto-de-forma-local">Ejecutar el proyecto de forma local</h2>
<p>Para ejecutar el proyecto se utiliza el comando:</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>manage.py<span class="w"> </span>runserver
</code></pre></div>
<p>Para acceder al sitio en desarrollo se realiza mediante <code>localhost</code> en el puerto seleccionado, t칤picamente <code>http://127.0.0.1:8000/</code>.</p>
<h2 id="como-actualizar-el-servidor">C칩mo actualizar el servidor</h2>
<ul>
<li>Hacer cambios en una rama dedicada para tal fin</li>
<li>Probar los cambios y fusionar (o hacer PR) con <code>main</code></li>
<li>Luego hacer una fusi칩n con <code>server</code> que es la rama en el servidor</li>
<li>Entrar al servidor con SSH al usuario <code>tcu</code></li>
<li>Si <strong>no</strong> hay cambios en los esquemas de la base de datos:</li>
<li><code>cd ferias/</code></li>
<li><code>git status</code></li>
<li><code>git stash</code> (opcional, para "poner al lado" cualquier modificaci칩n hecha en el servidor, que idealmente no deber칤an existir, excepto para "remiendos" temporales)</li>
<li><code>git pull</code></li>
<li><code>sudo systemctl restart nginx</code></li>
<li><code>sudo systemctl restart gunicorn</code></li>
<li>Si <strong>s칤</strong> hay cambios en los esquemas de la base de datos (en alg칰n <code>models.py</code>)</li>
<li><code>cd ferias/</code></li>
<li><code>git status</code></li>
<li><code>git stash</code></li>
<li><code>git pull</code></li>
<li>Entrar al ambiente virtual: <code>source feriasenv/bin/activate</code></li>
<li>Por <em>prevenci칩n</em>, se puede hacer una descarga de las tablas que van a ser modificadas, con <code>python manage.py dumpdata &lt;app&gt;.&lt;model&gt;</code> para guardar en el fixture <code>&lt;app&gt;.json</code> o <code>&lt;app&gt;_&lt;model&gt;.json</code>. Esto es importante porque las migraciones pueden salir mal.</li>
<li>Hacer las migraciones de cada app: <code>python manage.py makemigrations &lt;app&gt;</code></li>
<li>Migrar: <code>python manage.py migrate</code></li>
<li>(Aqu칤 pueden pasar un mont칩n de cosas tenebrosas con la base de datos)</li>
<li>Salir del ambiente virtual: <code>deactivate</code></li>
<li><code>sudo systemctl restart nginx</code></li>
<li><code>sudo systemctl restart gunicorn</code></li>
</ul>
<p>Con suerte, vamos al navegador y probamos si funciona.</p>
<h2 id="problemas-cargando-archivos-estaticos-por-error-403-forbidden">Problemas cargando archivos est치ticos por error 403 Forbidden</h2>
<p>Para servir archivos est치ticos en el servidor es necesario hacer lo <a href="https://docs.djangoproject.com/en/4.2/howto/static-files/">usual</a>:</p>
<div class="highlight"><pre><span></span><code><span class="o">(</span>feriasenv<span class="o">)</span><span class="w"> </span>tcu@ubuntu-ferias:~/ferias<span class="w"> </span>python<span class="w"> </span>manage.py<span class="w"> </span>collectstatic
</code></pre></div>
<p>Sin embargo, puede haber problemas al cargar im치genes o CSS, JS, etc. con un error 403 Forbidden. Esto sucede <a href="https://www.digitalocean.com/community/questions/i-m-getting-a-403-forbidden-error-when-trying-to-access-static-files">t칤picamente</a> por permisos o la propiedad de los archivos. La soluci칩n a la 칰ltima configuraci칩n fue:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>gpasswd<span class="w"> </span>-a<span class="w"> </span>tcu<span class="w"> </span>www-data
</code></pre></div>
<p>Nota (24 de abril de 2024): la 칰ltima vez el comando fue <code>sudo gpasswd -a www-data bucr</code> (<code>bucr</code> es otro usuario, equivalente a <code>tcu</code>) y s칤 funcion칩. En fin.</p>
<p>que le da permisos al usuario <code>tcu</code> dentro de <code>www-data</code>.</p>
<p>Es posible probar la asignaci칩n con <code>getent group www-data</code>, que devolver치 algo como <code>www-data:x:33:tcu</code>. 쯈u칠 es <a href="https://askubuntu.com/questions/873839/what-is-the-www-data-user">www-data</a>?</p>
<p>Luego de esto viene el reinicio usual de Nginx y Gunicorn (que no s칠 si ser치 estrictamente necesario).</p>
<p>Otra forma de resolver (cuando le da la gana) este problema es asignando manualmente y directamente los permisos a <code>www-data</code> para acceder a <code>staticfiles/</code>, as칤:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>www-data:www-data<span class="w"> </span>/path/to/static/files
</code></pre></div>
<p>y luego:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>www-data:www-data<span class="w"> </span>/path/to/static/files
</code></pre></div>
<p>y finalmente reiniciando Nginx y Gunicorn.</p>
<h2 id="aplicaciones-del-sitio">Aplicaciones del sitio</h2>
<p>Django utiliza "apps" para manejar el sitio. Por experiencia, sabemos que son divisiones 칰tiles para la organizaci칩n del sitio, aunque realmente desde una sola app se podr칤an realizar todas las funciones. Por orden, sin embargo, es mejor hacer una separaci칩n funcional. En ese sentido, y con base en la funcionalidad esperada del sitio, se han creado los siguientes apps:</p>
<dl>
    <dt>sitio</dt>
    <dd>Administra p치ginas generales, como el "index", acerca de, contacto, etc.</dd>
    <dt>datos</dt>
    <dd>Administra la base de datos de ferias.</dd>
    <dt>productos</dt>
    <dd>Administra la base de datos de productos ofrecidos en las ferias.</dd>
    <dt>informacion</dt>
    <dd>Administra las p치ginas de informaci칩n para visitantes, como blogs, tutoriales, etc.</dd>
    <dt>crowdsourcing</dt>
    <dd>Administra la colaboraci칩n colectiva para el mantenimiento y actualizaci칩n de datos de las ferias y productos.</dd>
    <dt>api</dt>
    <dd>Administra un API p칰blico para que cualquier persona recopile datos de este proyecto.</dd>
    <dt>usuarios</dt>
    <dd>Administra los distintos tipos de usuarios del sitio.</dd>
</dl>

<h2 id="paginas-del-sitio">P치ginas del sitio</h2>
<p>Con base en la funcionalidad descrita, es posible crear un primer esbozo de las p치ginas que tendr치 el sitio (arquitectura de informaci칩n), clasificadas seg칰n el app que las gestiona:</p>
<ul>
<li><strong><em>sitio</em></strong><ul>
<li><code>/</code>: p치gina de bienvenida</li>
<li><code>/acerca</code>, <code>/contacto</code>, etc.: informaci칩n sobre el sitio web</li>
</ul>
</li>
<li><strong><em>datos</em></strong><ul>
<li><code>/ferias</code>: p치gina de meta informaci칩n sobre los datos que contiene la p치gina</li>
<li><code>/ferias/&lt;c칩digo-de-feria&gt;</code>: informaci칩n b치sica de la feria</li>
<li><code>/ferias/&lt;c칩digo-de-feria&gt;/edicion</code>: edici칩n de la informaci칩n</li>
</ul>
</li>
<li><strong><em>productos</em></strong><ul>
<li><code>/productos</code>: p치gina de meta informaci칩n sobre los datos que contiene la p치gina</li>
<li><code>/productos/&lt;c칩digo-de-producto&gt;</code>: editor de datos del producto elegido</li>
</ul>
</li>
<li><strong><em>informacion</em></strong><ul>
<li><code>/informacion</code>: p치gina de bienvenida a la secci칩n de informaci칩n</li>
<li><code>/blog</code>, <code>/articulo</code>, etc.: otros sitios</li>
</ul>
</li>
<li><strong><em>crowdsourcing</em></strong><ul>
<li><code>/colaboracion</code>: p치gina de bienvenida de la secci칩n de colaboraci칩n colectiva</li>
<li><code>/colaboracion/</code>:</li>
</ul>
</li>
<li><strong><em>api</em></strong><ul>
<li><code>/api</code>: p치gina de bienvenida e informaci칩n sobre el API el proyecto</li>
</ul>
</li>
<li><strong><em>usuarios</em></strong><ul>
<li><code>/usuarios</code>: p치gina de informaci칩n de usuarios</li>
<li><code>/usuarios/perfil</code>: p치gina de informaci칩n de la persona usuaria</li>
</ul>
</li>
</ul>
<h3 id="mapa-del-sitio">Mapa del sitio</h3>
<pre class="mermaid"><code>stateDiagram-v2
    por : Portada
    fer : Ferias
    feX : Cada feria
    fed : Editar info
    pro : Productos
    prX : Cada producto
    inf : Informaci칩n
    blo : Blog
    cro : Crowdsourcing
    api : API
    ace : Acerca de
    reg : Registro
    ing : Ingreso
    ini : Inicio
    per : Perfil
    edi : Ediciones
    state log &lt;&lt;choice&gt;&gt;
    state usu &lt;&lt;choice&gt;&gt;
    state men &lt;&lt;fork&gt;&gt;

    [*] --&gt; por
    por --&gt; fer
    fer --&gt; feX
    feX --&gt; fed
    por --&gt; pro
    pro --&gt; prX
    por --&gt; inf
    inf --&gt; blo
    inf --&gt; cro
    inf --&gt; api
    por --&gt; ace
    por --&gt; log
    log --&gt; ini : Logueado
    log --&gt; usu : No logueado
    usu --&gt; ing : Registrado
    usu --&gt; reg : No registrado
    ing --&gt; ini
    reg --&gt; ing
    ini --&gt; men
    men --&gt; per
    men --&gt; edi</code></pre>
<h2 id="anexos">Anexos</h2>
<h3 id="como-instalar-postgresql-en-macos">C칩mo instalar PostgreSQL en macOS</h3>
<p>Nota: en Ubuntu viene instalado por defecto.</p>
<p>Con Homebrew:</p>
<p><div class="highlight"><pre><span></span><code>brew<span class="w"> </span>update
</code></pre></div>
para tener la 칰ltima versi칩n de Homebrew. Luego:
<div class="highlight"><pre><span></span><code>brew<span class="w"> </span>install<span class="w"> </span>postgresql
</code></pre></div>
para instalar PostgreSQL. Para activarlo, es necesario hacer:
<div class="highlight"><pre><span></span><code>brew<span class="w"> </span>services<span class="w"> </span>start<span class="w"> </span>postgresql
</code></pre></div>
Nota: es posible que sea <code>brew services start postgresql@14</code>. Y finalmente es posible comprobar su funcionamiento con:
<div class="highlight"><pre><span></span><code>brew<span class="w"> </span>services<span class="w"> </span>list
</code></pre></div>
Ahora hay que instalar PostGIS, con:
<div class="highlight"><pre><span></span><code>brew<span class="w"> </span>install<span class="w"> </span>postgis
</code></pre></div>
Luego es posible seguir el procedimiento de migraci칩n a GeoDjango indicado arriba.</p>
<h3 id="problemas-con-gdal">Problemas con GDAL</h3>
<p>A veces GDAL da problemas. (GDAL sirve para PostGIS). Con la reciente actualizaci칩n de Homebrew, algo estaba saliendo mal, que dec칤a tipo:</p>
<div class="highlight"><pre><span></span><code>...
from django.contrib.gis.gdal.prototypes import ds as vcapi
...
Reason: tried: &#39;/opt/homebrew/opt/hdf5/lib/libhdf5_hl.200.dylib&#39; (no such file) ... &#39;/usr/lib/libhdf5_hl.200.dylib&#39; (no such file, not in dyld cache)
</code></pre></div>
<p>La soluci칩n (aparentemente riesgosa) fue hacer:</p>
<div class="highlight"><pre><span></span><code>brew<span class="w"> </span>reinstall<span class="w"> </span>gdal<span class="w"> </span>--build-from-source
</code></pre></div>
<p>que parece que sab칤an sus creadores de <a href="https://github.com/OSGeo/homebrew-osgeo4mac/issues/1368#issuecomment-596452645">OSGEO</a>. </p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand", "navigation.tabs", "navigation.footer", "toc.integrate"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>